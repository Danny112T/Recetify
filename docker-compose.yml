version: '3'
services:
# The Database

    database:

        container_name: mysql_database
        image: mysql:8.0
        restart: unless-stopped

        volumes:

            - dbdata:/var/lib/mysql
            - ./docker-compose/dev/mysql:/docker-entrypoint-initdb.d

        environment:

            - “MYSQL_USER=root”

            - “MYSQL_PASSWORD=”

            - "MYSQL_ALLOW_EMPTY_PASSWORD=true"

        ports:

            - 3306:3306

    nginx:
        image: nginx:1.17-alpine
        container_name: recetify-nginx
        restart: unless-stopped
        ports:
            - 8000:80
        volumes:
            - ./:/var/www
            - ./docker-compose/nginx:/etc/nginx/conf.d


#The Application

    app:
        image: recetify_app
        container_name: recetify_app
        command: sh -c "php artisan storage:link && php artisan octane:start --watch --server=\"swoole\" --host=0.0.0.0 --port=9000"

        build:

            context: ./

            dockerfile: dockerfile
            args:
                COMPOSER_HASH: ${COMPOSER_HASH}

        volumes:
            - ./app:/var/www/app
            - ./config:/var/www/config
            - ./database:/var/www/database
            - ./graphql:/var/www/graphql
            - ./routes:/var/www/routes
            - ./resources:/var/www/resources
            - ./tests:/var/www/test
            - ./storage:/var/www/storage
            - ./public:/var/www/public
            - ./composer.lock:/var/www/composer.lock
            - ./composer.json:/var/www/composer.json
        env_file: .env.local

        ports:
            - 9000:9501
